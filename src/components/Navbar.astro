---
// Navbar.astro - Modern navigation component with hexagonal design
// Includes language switcher, smooth animations, and responsive design

interface Props {
  t: (key: string) => string;
  currentLang: 'es' | 'en';
}

const { t, currentLang } = Astro.props;

// Navigation items
const navItems = [
  { key: 'home', href: '#hero' },
  { key: 'services', href: '#services' },
  { key: 'portfolio', href: '#portfolio' },
  { key: 'testimonials', href: '#testimonials' },
  { key: 'contact', href: '#contact' }
];

// Language options
const languages = [
  { code: 'es', name: 'ES', flag: 'ðŸ‡ªðŸ‡¸' },
  { code: 'en', name: 'EN', flag: 'ðŸ‡ºðŸ‡¸' }
];
---

<nav 
  id="navbar"
  class="fixed top-0 left-0 right-0 z-50 bg-black/80 backdrop-blur-md border-b border-accent/20 transition-all duration-300"
  data-navbar
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16 lg:h-20">
      
      <!-- Brand Logo -->
      <div class="flex items-center">
        <a 
          href="#hero" 
          class="flex items-center space-x-3 group"
          aria-label="BEMYTECH Home"
        >
          <!-- BEMYTECH Logo SVG -->
          <div class="navbar-logo w-8 h-9 relative">
            <svg width="277" height="323" viewBox="0 0 277 323" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full h-full">
              <!-- Top Hexagon -->
              <path 
                d="M235.792 64.6952C235.792 74.0125 236.024 83.3405 235.626 92.6405C235.528 94.8965 233.915 97.9712 232.044 99.1285C216.992 108.439 201.678 117.323 186.523 126.472C182.575 128.856 179.167 129.267 174.932 126.723C158.508 116.855 141.838 107.4 125.41 97.5378C123.762 96.5485 122.215 93.8512 122.192 91.9285C121.982 74.2098 122.115 56.4872 122.155 38.7672C122.164 34.3845 123.996 31.2592 127.918 28.9805C143.538 19.9005 159.071 10.6712 174.576 1.39383C177.774 -0.519506 180.516 -0.434175 183.723 1.47116C199.728 10.9778 215.798 20.3778 231.923 29.6778C234.836 31.3565 235.903 33.4565 235.847 36.7432C235.691 46.0592 235.792 55.3778 235.792 64.6952Z" 
                fill="#82C232" 
                class="nav-hex-1"
              />
              <!-- Right Hexagon -->
              <path 
                d="M275.186 175.136C275.221 175.136 275.257 175.136 275.292 175.136V165.719C275.257 165.719 275.221 165.719 275.186 165.719V175.136ZM209.214 166.713C209.177 166.737 209.141 166.76 209.105 166.783V202.52C209.141 202.52 209.177 202.52 209.214 202.52V166.713ZM208.037 184.068C208.037 178.245 208.09 172.421 208.001 166.6C207.978 165.099 208.401 164.181 209.72 163.416C219.986 157.467 230.226 151.471 240.449 145.444C241.588 144.772 242.489 144.773 243.629 145.439C254.009 151.501 264.408 157.535 274.833 163.52C276.013 164.197 276.357 165 276.352 166.308C276.302 178.031 276.289 189.755 276.349 201.477C276.358 203.316 275.788 204.408 274.133 205.36C264.05 211.161 254.026 217.064 244.024 223.004C242.765 223.752 241.856 223.683 240.64 222.971C230.334 216.932 220.005 210.936 209.649 204.985C208.392 204.264 207.989 203.408 208.006 202.001C208.076 196.024 208.036 190.045 208.037 184.068Z" 
                fill="#82C232" 
                class="nav-hex-2"
              />
              <!-- Left Large Hexagon -->
              <path 
                d="M2.59802 247.973C2.68335 247.973 2.76869 247.972 2.85402 247.972ZM0.0846877 204.581C0.0873544 190.888 0.211354 177.193 0.002021 163.502C-0.0513123 159.972 0.942021 157.814 4.04335 156.017C28.186 142.025 52.2674 127.926 76.3047 113.754C78.9847 112.173 81.1034 112.176 83.7847 113.743C108.195 127.999 132.649 142.185 157.163 156.261C159.938 157.853 160.746 159.742 160.734 162.816C160.619 190.385 160.587 217.954 160.727 245.523C160.749 249.845 159.407 252.413 155.518 254.651C131.807 268.293 108.233 282.174 84.7127 296.144C81.754 297.901 79.6127 297.741 76.754 296.065C52.5207 281.865 28.23 267.763 3.87669 253.772C0.919354 252.073 -0.025979 250.06 0.0126877 246.754C0.175354 232.698 0.082021 218.64 0.0846877 204.581Z" 
                fill="#82C232" 
                class="nav-hex-3"
              />
              <!-- Bottom Right Hexagon -->
              <path 
                d="M205.747 294.234C205.768 294.234 205.788 294.234 205.81 294.234V288.683C205.788 288.683 205.768 288.683 205.747 288.683V294.234ZM166.859 289.27C166.838 289.283 166.816 289.297 166.795 289.31V310.375C166.816 310.375 166.838 310.375 166.859 310.375V289.27ZM166.164 299.499C166.166 296.066 166.196 292.634 166.144 289.202C166.131 288.317 166.379 287.777 167.156 287.326C173.208 283.818 179.244 280.285 185.27 276.731C185.942 276.335 186.472 276.337 187.146 276.729C193.264 280.302 199.394 283.858 205.539 287.387C206.234 287.786 206.436 288.259 206.434 289.03C206.404 295.941 206.398 302.851 206.432 309.762C206.438 310.845 206.102 311.489 205.126 312.05C199.183 315.469 193.274 318.949 187.378 322.45C186.636 322.891 186.099 322.851 185.383 322.431C179.308 318.871 173.219 315.337 167.115 311.83C166.374 311.403 166.136 310.899 166.147 310.07C166.187 306.547 166.164 303.023 166.164 299.499Z" 
                fill="#82C232" 
                class="nav-hex-4"
              />
            </svg>
          </div>
          
          <!-- Brand Name -->
          <div class="hidden sm:block">
            <span class="text-xl lg:text-2xl font-bold text-white group-hover:text-accent transition-colors duration-300">BEMYTECH</span>
            <div class="text-xs text-accent font-medium">Tech Solutions</div>
          </div>
        </a>
      </div>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-8">
        {navItems.map((item) => (
          <a
            href={item.href}
            class="nav-link relative text-white/80 hover:text-accent font-medium transition-all duration-300 py-2 px-3 group"
            data-nav-link={item.key}
          >
            {t(`nav.${item.key}`)}
            
            <!-- Hover underline effect -->
            <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-accent transition-all duration-300 group-hover:w-full"></span>
            
            <!-- Hexagonal hover indicator -->
            <div class="absolute -top-2 left-1/2 transform -translate-x-1/2 w-2 h-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
              <svg viewBox="0 0 10 10" class="w-full h-full text-accent fill-current">
                <polygon points="5,0.5 8.5,2.5 8.5,7.5 5,9.5 1.5,7.5 1.5,2.5" />
              </svg>
            </div>
          </a>
        ))}
      </div>

      <!-- Language Switcher & Mobile Menu -->
      <div class="flex items-center space-x-4">
        
        <!-- Language Switcher -->
        <div class="relative language-switcher">
          <button
            class="flex items-center space-x-2 text-white/80 hover:text-accent font-medium transition-colors duration-300 py-2 px-3 rounded-lg border border-accent/20 hover:border-accent/40 backdrop-blur-sm"
            data-language-toggle
          >
            <span class="text-sm">{languages.find(lang => lang.code === currentLang)?.flag}</span>
            <span class="hidden sm:inline text-sm font-semibold">{currentLang.toUpperCase()}</span>
            <svg class="w-4 h-4 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>
          
          <!-- Language Dropdown -->
          <div 
            class="absolute right-0 mt-2 w-32 bg-black/90 backdrop-blur-md rounded-lg border border-accent/20 shadow-xl opacity-0 invisible transition-all duration-300 transform translate-y-2"
            data-language-dropdown
          >
            {languages.map((lang) => (
              <a
                href={`?lang=${lang.code}`}
                class={`flex items-center space-x-3 px-4 py-3 text-sm font-medium transition-colors duration-200 first:rounded-t-lg last:rounded-b-lg ${
                  currentLang === lang.code 
                    ? 'text-accent bg-accent/10' 
                    : 'text-white/80 hover:text-accent hover:bg-accent/5'
                }`}
                data-language-option={lang.code}
              >
                <span>{lang.flag}</span>
                <span>{lang.name}</span>
                {currentLang === lang.code && (
                  <svg class="w-4 h-4 ml-auto" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                )}
              </a>
            ))}
          </div>
        </div>

        <!-- Mobile Menu Button -->
        <button
          class="md:hidden flex items-center justify-center w-10 h-10 text-white/80 hover:text-accent border border-accent/20 hover:border-accent/40 rounded-lg transition-colors duration-300"
          data-mobile-menu-toggle
          aria-label="Toggle navigation menu"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div 
      class="md:hidden absolute top-full left-0 right-0 bg-black/95 backdrop-blur-md border-b border-accent/20 opacity-0 invisible transition-all duration-300 transform -translate-y-4"
      data-mobile-menu
    >
      <div class="py-4 px-4 space-y-2">
        {navItems.map((item) => (
          <a
            href={item.href}
            class="block py-3 px-4 text-white/80 hover:text-accent hover:bg-accent/5 font-medium transition-all duration-300 rounded-lg"
            data-mobile-nav-link={item.key}
          >
            {t(`nav.${item.key}`)}
          </a>
        ))}
      </div>
    </div>
  </div>
</nav>

<style>
  /* Navbar scroll behavior */
  #navbar {
    transform: translateZ(0);
    will-change: transform, background-color;
  }

  #navbar.scrolled {
    @apply bg-black/95 shadow-lg border-accent/30;
  }

  /* Navbar Logo Animations */
  .navbar-logo {
    transition: all 0.3s ease;
    transform: translateZ(0);
  }

  .navbar-logo:hover {
    transform: scale(1.1) translateZ(0);
  }

  .nav-hex-1, .nav-hex-2, .nav-hex-3, .nav-hex-4 {
    transition: all 0.3s ease;
    transform-origin: center;
  }

  .navbar-logo:hover .nav-hex-1 {
    transform: scale(1.05) rotate(2deg);
    filter: drop-shadow(0 0 8px #82C232);
  }

  .navbar-logo:hover .nav-hex-2 {
    transform: scale(1.03) rotate(-1deg);
    filter: drop-shadow(0 0 6px #82C232);
    animation-delay: 0.1s;
  }

  .navbar-logo:hover .nav-hex-3 {
    transform: scale(1.02) rotate(1deg);
    filter: drop-shadow(0 0 10px #82C232);
    animation-delay: 0.2s;
  }

  .navbar-logo:hover .nav-hex-4 {
    transform: scale(1.04) rotate(-2deg);
    filter: drop-shadow(0 0 7px #82C232);
    animation-delay: 0.3s;
  }

  /* Language dropdown animations */
  .language-switcher:hover [data-language-dropdown] {
    @apply opacity-100 visible translate-y-0;
  }

  /* Mobile menu animations */
  .mobile-menu-open [data-mobile-menu] {
    @apply opacity-100 visible translate-y-0;
  }

  /* Navigation link active state */
  .nav-link.active {
    @apply text-accent;
  }

  .nav-link.active span {
    @apply w-full;
  }

  /* Hardware acceleration */
  .nav-link,
  [data-language-toggle],
  [data-mobile-menu-toggle] {
    transform: translateZ(0);
  }

  /* Smooth hover transitions */
  .nav-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, transparent, rgba(139, 197, 63, 0.1), transparent);
    opacity: 0;
    transition: opacity 0.3s ease;
    border-radius: 6px;
    transform: translateZ(0);
  }

  .nav-link:hover::before {
    opacity: 1;
  }

  /* Responsive font sizes */
  @media (max-width: 640px) {
    .nav-link {
      font-size: 0.9rem;
    }
  }

  /* Animation for logo pulse */
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; }
  }

  .animate-pulse {
    animation: pulse 3s ease-in-out infinite;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const navbar = document.getElementById('navbar');
    const languageToggle = document.querySelector('[data-language-toggle]');
    const languageDropdown = document.querySelector('[data-language-dropdown]');
    const mobileMenuToggle = document.querySelector('[data-mobile-menu-toggle]');
    const mobileMenu = document.querySelector('[data-mobile-menu]');
    const navLinks = document.querySelectorAll('[data-nav-link]');
    const mobileNavLinks = document.querySelectorAll('[data-mobile-nav-link]');

    // Navbar scroll behavior
    let lastScrollY = window.scrollY;
    
    const handleScroll = () => {
      const currentScrollY = window.scrollY;
      
      if (navbar) {
        if (currentScrollY > 50) {
          navbar.classList.add('scrolled');
        } else {
          navbar.classList.remove('scrolled');
        }
        
        // Hide/show navbar on scroll
        if (currentScrollY > lastScrollY && currentScrollY > 100) {
          navbar.style.transform = 'translateY(-100%)';
        } else {
          navbar.style.transform = 'translateY(0)';
        }
      }
      
      lastScrollY = currentScrollY;
    };

    // Throttled scroll handler
    let scrollTimeout: ReturnType<typeof setTimeout>;
    window.addEventListener('scroll', () => {
      if (scrollTimeout) {
        clearTimeout(scrollTimeout);
      }
      scrollTimeout = setTimeout(handleScroll, 10);
    });

    // Language dropdown toggle
    if (languageToggle && languageDropdown) {
      languageToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        languageDropdown.classList.toggle('opacity-0');
        languageDropdown.classList.toggle('invisible');
        languageDropdown.classList.toggle('translate-y-2');
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', () => {
        if (languageDropdown) {
          languageDropdown.classList.add('opacity-0', 'invisible', 'translate-y-2');
        }
      });
    }

    // Mobile menu toggle
    if (mobileMenuToggle && mobileMenu) {
      mobileMenuToggle.addEventListener('click', () => {
        document.body.classList.toggle('mobile-menu-open');
        mobileMenu.classList.toggle('opacity-0');
        mobileMenu.classList.toggle('invisible');
        mobileMenu.classList.toggle('-translate-y-4');
      });
    }

    // Active navigation link tracking
    const updateActiveLink = () => {
      const sections = document.querySelectorAll('section[id]');
      let current = '';

      sections.forEach((section) => {
        const sectionEl = section as HTMLElement;
        const sectionTop = sectionEl.offsetTop;
        const sectionHeight = sectionEl.clientHeight;
        if (window.scrollY >= sectionTop - 200) {
          current = section.getAttribute('id') || '';
        }
      });

      // Update desktop nav links
      navLinks.forEach((link) => {
        link.classList.remove('active');
        if (link.getAttribute('data-nav-link') === current || 
            (current === 'hero' && link.getAttribute('data-nav-link') === 'home')) {
          link.classList.add('active');
        }
      });

      // Update mobile nav links
      mobileNavLinks.forEach((link) => {
        link.classList.remove('active');
        if (link.getAttribute('data-mobile-nav-link') === current ||
            (current === 'hero' && link.getAttribute('data-mobile-nav-link') === 'home')) {
          link.classList.add('active');
        }
      });
    };

    // Throttled scroll handler for active links
    let activeTimeout: ReturnType<typeof setTimeout>;
    window.addEventListener('scroll', () => {
      if (activeTimeout) {
        clearTimeout(activeTimeout);
      }
      activeTimeout = setTimeout(updateActiveLink, 100);
    });

    // Initialize active link on load
    updateActiveLink();

    // Smooth scrolling for nav links
    const allNavLinks = [...navLinks, ...mobileNavLinks];
    allNavLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const href = link.getAttribute('href');
        if (href) {
          const target = document.querySelector(href);
          if (target) {
            // Close mobile menu if open
            if (mobileMenu) {
              mobileMenu.classList.add('opacity-0', 'invisible', '-translate-y-4');
              document.body.classList.remove('mobile-menu-open');
            }
            
            // Smooth scroll to target
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        }
      });
    });
  });
</script> 